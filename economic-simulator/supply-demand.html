<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Challenge Supply & Demand: When Real Markets Break the Rules | Interactive
      Economic Simulator
    </title>

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="Challenge traditional Supply & Demand theory with real market data. Interactive simulator showing how actual pricing contradicts textbook models - from Bitcoin volatility to luxury goods paradoxes."
    />
    <meta
      name="keywords"
      content="supply and demand, market equilibrium, price discovery, free markets, spontaneous order, fair prices, interactive simulator, austrian economics"
    />
    <meta name="author" content="Julien Reszka" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#6f42c1" />

    <!-- Open Graph -->
    <meta
      property="og:title"
      content="Challenge Supply & Demand: When Real Markets Defy Theory"
    />
    <meta
      property="og:description"
      content="Interactive simulator exploring how real markets violate textbook supply and demand models, from Bitcoin volatility to luxury goods paradoxes."
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://julienreszka.github.io/economic-simulator/supply-demand.html"
    />
    <meta
      property="og:image"
      content="https://julienreszka.github.io/economic-simulator/supply-demand-preview.png"
    />
    <meta property="og:site_name" content="Economic Curves Simulator" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Challenge Supply & Demand: When Real Markets Defy Theory"
    />
    <meta
      name="twitter:description"
      content="See how real market data contradicts textbook supply & demand models."
    />
    <meta name="twitter:creator" content="@julienreszka" />

    <!-- Canonical URL -->
    <link
      rel="canonical"
      href="https://julienreszka.github.io/economic-simulator/supply-demand.html"
    />

    <!-- Shared Styles -->
    <link rel="stylesheet" href="shared-styles.css" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      .supplydemand-specific h3 {
        color: #6f42c1 !important;
      }
    </style>
  </head>

  <body>
    <div id="container">
      <!-- Navigation Breadcrumb -->
      <nav class="nav-breadcrumb" aria-label="Breadcrumb">
        <a href="index.html">← Back to All Curves</a>
      </nav>

      <h1>
        Supply & Demand Theory Falls Apart: When Real Markets Expose Economic
        Lies
      </h1>

      <p>
        <strong>Revolutionary Insight:</strong> The sacred cow of economic
        theory - supply and demand curves - is a dangerous myth that bears no
        resemblance to how real markets actually work. For decades, economists
        have peddled the fiction that markets reach clean equilibriums through
        predictable curves. But when you examine actual market data, this theory
        collapses spectacularly. This interactive simulator exposes how textbook
        models systematically fail to explain real pricing—from Bitcoin's
        chaotic discovery to luxury goods that demolish traditional demand
        theory.
      </p>

      <!-- Interactive Simulation -->
      <section id="supplydemand-section">
        <h2>Interactive Supply & Demand: Theory vs. Real Market Data</h2>

        <form id="paramsFormSupplyDemand">
          <div class="param-group">
            <label for="market-type-select">Market Type:</label>
            <select id="market-type-select" aria-describedby="market-type-help">
              <option value="traditional">Traditional (Theory)</option>
              <option value="luxury">Luxury Goods (Veblen Effect)</option>
              <option value="network">Network/Tech (Scale Effects)</option>
              <option value="volatile">
                Volatile Assets (Austrian Discovery)
              </option>
            </select>
            <small id="market-type-help" class="help-text">
              Traditional follows textbook theory; Luxury shows upward demand;
              Network shows downward supply; Volatile shows Austrian price
              discovery
            </small>
          </div>

          <div class="param-group">
            <label for="a-supplydemand">Demand Factor (a):</label>
            <input
              type="number"
              id="a-supplydemand"
              value="150"
              step="10"
              min="50"
              max="500"
            />
          </div>

          <div class="param-group">
            <label for="b-supplydemand">Demand Sensitivity (b):</label>
            <input
              type="number"
              id="b-supplydemand"
              value="0.02"
              step="0.01"
              min="0.001"
              max="0.1"
            />
          </div>

          <div class="param-group">
            <label for="c-supplydemand">Supply Base Cost (c):</label>
            <input
              type="number"
              id="c-supplydemand"
              value="10"
              step="5"
              min="0"
              max="50"
            />
          </div>

          <div class="param-group">
            <label for="d-supplydemand">Supply Cost Growth (d):</label>
            <input
              type="number"
              id="d-supplydemand"
              value="0.5"
              step="0.1"
              min="0.1"
              max="2"
            />
          </div>
        </form>

        <div class="param-group">
          <label for="real-data-select">Show Real Market Data:</label>
          <select id="real-data-select" aria-describedby="real-data-help">
            <option value="none">None - Theory Only</option>
            <option value="bitcoin">Bitcoin (Volatile Discovery)</option>
            <option value="housing">US Housing (Supply Constraints)</option>
            <option value="tech">Tech Products (Scale Effects)</option>
            <option value="luxury">Luxury Goods (Status Effects)</option>
          </select>
          <small id="real-data-help" class="help-text">
            Real market data from various APIs showing how actual pricing defies
            traditional supply/demand theory
          </small>
          <div
            id="data-status-supply"
            style="margin-top: 5px; font-weight: bold"
          >
            Ready to load real market data
          </div>
        </div>

        <div
          class="chart-container"
          role="img"
          aria-labelledby="supplydemand-chart-label"
        >
          <canvas
            id="growthChartSupplyDemand"
            aria-label="Interactive Supply and Demand curves showing market equilibrium"
          ></canvas>
          <div id="supplydemand-chart-label" class="sr-only">
            Chart displaying Supply and Demand curves with quantity on x-axis
            and price on y-axis
          </div>
        </div>

        <div
          id="equilibrium-supplydemand"
          class="results-display"
          aria-live="polite"
        ></div>
      </section>

      <!-- Detailed Explanation -->
      <section>
        <h2>
          Supply & Demand Theory vs. Reality: How Austrian Economics Exposes the
          Academic Fraud
        </h2>

        <div style="margin-top: 15px; line-height: 1.6">
          <p>
            <strong
              >Traditional supply and demand theory is an academic fraud that
              has misled generations of students and policymakers.</strong
            >
            Austrian economists have systematically demolished the textbook
            X-shaped diagram, proving it's a dangerous oversimplification that
            ignores the complex, subjective nature of human valuation and market
            processes. When we examine actual market data, we don't just
            discover "surprising patterns" - we find overwhelming evidence that
            destroys fundamental assumptions about how prices form and markets
            function.
          </p>

          <h3>The Austrian Critique: Why Curves Miss the Point</h3>
          <p>
            <strong>Ludwig von Mises and methodological individualism:</strong>
          </p>
          <ul>
            <li>
              <strong>No Aggregate Curves:</strong> "Supply" and "demand" don't
              exist as objective entities - only individual valuations
            </li>
            <li>
              <strong>Subjective Value:</strong> Value exists only in individual
              minds, can't be measured or aggregated mathematically
            </li>
            <li>
              <strong>Ordinal Rankings:</strong> People rank preferences (A > B
              > C) but can't quantify "how much" they prefer
            </li>
            <li>
              <strong>Contextual Valuation:</strong> Same person values same
              good differently in different circumstances
            </li>
          </ul>

          <h3>Real Market "Surprises" That Prove Austrian Insights</h3>

          <h4>1. Downward-Sloping Supply Curves (Scale Effects)</h4>
          <p><strong>Theory predicts:</strong> Higher prices → more supply</p>
          <p>
            <strong>Reality shows:</strong> Many industries have
            downward-sloping supply curves:
          </p>
          <ul>
            <li>
              <strong>Technology:</strong> Computer chips, software, smartphones
              get cheaper as volume increases
            </li>
            <li>
              <strong>Manufacturing:</strong> Economies of scale make large
              production runs more efficient
            </li>
            <li>
              <strong>Network Industries:</strong> More users → shared
              infrastructure → lower per-unit costs
            </li>
            <li>
              <strong>Learning Effects:</strong> Experience curve makes
              production more efficient over time
            </li>
          </ul>

          <h4>2. Upward-Sloping Demand Curves (Veblen Effects)</h4>
          <p><strong>Theory predicts:</strong> Higher prices → less demand</p>
          <p>
            <strong>Reality shows:</strong> Luxury goods often have
            upward-sloping demand:
          </p>
          <ul>
            <li>
              <strong>Status Goods:</strong> Ferrari, Rolex, designer brands -
              higher prices increase desirability
            </li>
            <li>
              <strong>Quality Signaling:</strong> Wine, restaurants, healthcare
              - price indicates quality
            </li>
            <li>
              <strong>Network Effects:</strong> Social media, phones - value
              increases with user base
            </li>
            <li>
              <strong>Investment Assets:</strong> Art, collectibles - rising
              prices attract more buyers
            </li>
          </ul>

          <h4>3. Multiple Equilibria and Market Segmentation</h4>
          <p><strong>Theory shows:</strong> One clean intersection point</p>
          <p>
            <strong>Reality has:</strong> Markets often have multiple stable
            equilibria:
          </p>
          <ul>
            <li>
              <strong>Luxury vs. Mass Market:</strong> Same product category,
              completely different price points
            </li>
            <li>
              <strong>Geographic Segments:</strong> Different pricing in
              different locations
            </li>
            <li>
              <strong>Time-Based Pricing:</strong> Peak vs. off-peak, seasonal
              variations
            </li>
            <li>
              <strong>Customer Segments:</strong> Student discounts, senior
              pricing, bulk rates
            </li>
          </ul>

          <h4>4. Austrian Price Discovery vs. Equilibrium</h4>
          <p><strong>Israel Kirzner's entrepreneurial discovery:</strong></p>
          <ul>
            <li>
              <strong>Markets Never "Clear":</strong> Always in flux as
              entrepreneurs discover opportunities
            </li>
            <li>
              <strong>Arbitrage Process:</strong> Profit opportunities signal
              where prices are "wrong"
            </li>
            <li>
              <strong>Creative Destruction:</strong> Innovation constantly
              disrupts existing patterns
            </li>
            <li>
              <strong>Uncertainty vs. Risk:</strong> True uncertainty can't be
              calculated probabilistically
            </li>
          </ul>

          <h3>What Real Data Reveals</h3>

          <h4>Bitcoin and Austrian Value Theory</h4>
          <p>
            Cryptocurrency markets perfectly demonstrate Austrian insights about
            subjective value and price discovery under uncertainty. Bitcoin's
            extreme volatility shows how prices emerge from individual
            subjective valuations rather than objective supply/demand curves.
          </p>

          <h4>Housing and Regulatory Constraints</h4>
          <p>
            Housing markets show how regulatory constraints create artificial
            scarcity. Zoning laws, building permits, and rent control disconnect
            prices from simple supply/demand relationships, creating multiple
            price levels for similar properties.
          </p>

          <h4>Technology and Scale Economics</h4>
          <p>
            Tech products consistently show downward-sloping supply curves as
            manufacturing scales up. The price of smartphones, computers, and
            other electronics falls as production volumes increase - exactly
            opposite to textbook theory.
          </p>

          <h3>Austrian Policy Revolution: End the War on Market Discovery</h3>
          <p>
            <strong
              >The failure of traditional theory demands radical policy
              change:</strong
            >
          </p>
          <ul>
            <li>
              <strong>Abolish Regulatory Barriers:</strong> Eliminate ALL
              licensing, zoning, and entry restrictions that prevent
              entrepreneurial discovery
            </li>
            <li>
              <strong>End Monetary Manipulation:</strong> Destroy central banks
              that distort price signals through artificial interest rates and
              money printing
            </li>
            <li>
              <strong>Enforce Property Rights:</strong> Only clear, absolute
              ownership enables true market coordination without government
              interference
            </li>
            <li>
              <strong>Unleash Spontaneous Order:</strong> Government
              intervention in price discovery is economic vandalism that
              destroys wealth and information
            </li>
            <li>
              <strong>Ban Price Controls:</strong> Every artificial price is an
              act of economic warfare against the discovery process that creates
              prosperity
            </li>
          </ul>

          <h3>
            The Bottom Line: Traditional Economics Is a Dangerous Delusion
          </h3>
          <p>
            The "surprises" in real market data aren't exceptions to supply and
            demand theory -
            <strong
              >they're smoking gun evidence that the entire theoretical
              framework is a dangerous lie.</strong
            >
            Traditional economics has poisoned policy discussions for decades
            with mechanical equilibrium fantasies that have zero connection to
            reality. Markets are ongoing discovery processes where entrepreneurs
            and consumers continuously learn about value, scarcity, and
            opportunity - something no government planner or academic theorist
            can replicate.
          </p>

          <p>
            The elegant X-shaped diagram isn't just incomplete - it's actively
            harmful propaganda that justifies destructive government
            intervention. Real pricing reflects subjective human valuations,
            institutional constraints, technological possibilities, and
            entrepreneurial creativity. These factors don't just "resist
            mathematical modeling" - they demolish the very premise that markets
            can be controlled, predicted, or "optimized" by bureaucratic
            intervention. Only the right institutional framework unleashes this
            wealth-creating discovery process.
          </p>
        </div>
      </section>

      <!-- Natural Right Section -->
      <section class="natural-rights-section">
        <h2>The Right to Fair Prices</h2>

        <div class="right-card supplydemand-specific">
          <div class="right-principle">
            <p>
              <strong>Negative Right:</strong> Freedom from price controls,
              market manipulation, and artificial restrictions that prevent
              voluntary exchange from discovering fair market prices.
            </p>
          </div>

          <div class="right-positive">
            <h4>Essential Institutions for Fair Price Discovery:</h4>
            <ul>
              <li>
                <strong>Property Rights Protection:</strong> Legal frameworks
                ensuring secure ownership and ability to transfer goods
                voluntarily
              </li>
              <li>
                <strong>Contract Enforcement:</strong> Court systems that
                reliably enforce voluntary agreements between buyers and sellers
              </li>
              <li>
                <strong>Anti-Monopoly Framework:</strong> Legal structures
                preventing artificial market concentration while preserving
                competitive dynamics
              </li>
              <li>
                <strong>Information Transparency Rules:</strong> Requirements
                for honest disclosure of product quality and pricing terms
              </li>
              <li>
                <strong>Free Entry/Exit Provisions:</strong> Legal elimination
                of unnecessary barriers to market participation
              </li>
              <li>
                <strong>Currency Stability Systems:</strong> Monetary
                institutions that maintain stable units of account for price
                discovery
              </li>
              <li>
                <strong>Trade Freedom Protections:</strong> Constitutional
                limitations on government restrictions of voluntary commerce
              </li>
            </ul>
          </div>

          <div class="right-enemies" style="margin-top: 20px">
            <h4 style="margin-bottom: 15px; color: var(--text-color)">
              Current Threats to This Right - Institutional Enemies of Fair
              Pricing:
            </h4>
            <ul>
              <li>
                <strong>Price Control Regimes:</strong> Government-imposed price
                ceilings and floors that prevent market clearing
              </li>
              <li>
                <strong>Regulatory Capture:</strong> Industry incumbents using
                regulation to exclude competitors and maintain artificial
                pricing power
              </li>
              <li>
                <strong>Licensing Cartels:</strong> Professional licensing that
                restricts supply to inflate prices beyond competitive levels
              </li>
              <li>
                <strong>Zoning Restrictions:</strong> Land use controls that
                artificially constrain supply and inflate property values
              </li>
              <li>
                <strong>Import Protection:</strong> Tariffs and quotas that
                prevent international competition from disciplining domestic
                prices
              </li>
              <li>
                <strong>Monetary Manipulation:</strong> Central bank policies
                that distort price signals through artificial interest rates and
                money creation
              </li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <script>
      // Real market data integration
      let realMarketData = {
        bitcoin: [],
        housing: [],
        tech: [],
        luxury: [],
      };

      let isDataLoaded = false;

      // Austrian-inspired market models
      function getMarketParameters(marketType) {
        switch (marketType) {
          case "traditional":
            return {
              demandFunction: (q, a, b) => a / Math.pow(1 + b * q, 0.5),
              supplyFunction: (q, c, d) => c + d * Math.pow(q, 1.3),
              description: "Classic downward demand, upward supply",
            };
          case "luxury":
            return {
              demandFunction: (q, a, b) => {
                // Parameterized Veblen effect using a and b
                const basePrice = a / 2; // Scales with demand factor
                const threshold = 1000 * b; // Default 20 for b=0.02
                const veblenStrength = 1.5;
                const veblenEffect =
                  q < threshold
                    ? q * veblenStrength
                    : threshold * veblenStrength;
                const eventualDecline =
                  q > threshold ? (q - threshold) * 0.8 : 0;
                return Math.max(20, basePrice + veblenEffect - eventualDecline);
              },
              supplyFunction: (q, c, d) => c + d * Math.pow(q, 0.8), // Moderate supply curve
              description: "Upward-sloping demand (status effect)",
            };
          case "network":
            return {
              demandFunction: (q, a, b) => {
                // Network effects increase value with adoption
                const networkValue = Math.log(1 + q * 0.1) * 50;
                const baseDemand = a / Math.pow(1 + b * q, 0.7);
                return baseDemand + networkValue;
              },
              supplyFunction: (q, c, d) => {
                // Downward-sloping supply for economies of scale
                return c + d * 100 * Math.exp(-q * 0.05);
              },
              description: "Network effects + economies of scale",
            };
          case "volatile":
            return {
              demandFunction: (q, a, b) => {
                // Austrian subjective value discovery
                const volatility =
                  Math.sin(q * 0.5) * 20 + Math.cos(q * 0.3) * 15;
                const baseDemand = a / Math.pow(1 + b * q, 0.5);
                return Math.max(0, baseDemand + volatility);
              },
              supplyFunction: (q, c, d) => {
                // Supply also volatile due to uncertainty
                const supplyShocks = Math.sin(q * 0.7) * 10;
                return Math.max(c, c + d * Math.pow(q, 1.2) + supplyShocks);
              },
              description: "Austrian price discovery with uncertainty",
            };
          default:
            return getMarketParameters("traditional");
        }
      }

      // Fetch real market data
      async function loadRealMarketData(dataType) {
        updateDataStatus("Loading real market data...");

        try {
          switch (dataType) {
            case "bitcoin":
              await loadBitcoinData();
              break;
            case "housing":
              await loadHousingData();
              break;
            case "tech":
              await loadTechData();
              break;
            case "luxury":
              await loadLuxuryData();
              break;
          }

          isDataLoaded = true;
          updateSupplyDemandSimulation();
        } catch (error) {
          console.error("Failed to load market data:", error);
          updateDataStatus(`Failed to load data: ${error.message}`);
        }
      }

      async function loadBitcoinData() {
        // Get Bitcoin price data showing extreme volatility
        const response = await fetch(
          "https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=30"
        );
        const data = await response.json();

        if (data.prices) {
          realMarketData.bitcoin = data.prices
            .slice(0, 20)
            .map((item, index) => ({
              x: index * 5, // Quantity proxy
              y: item[1] / 1000, // Price scaled down
              timestamp: item[0],
              label: `Bitcoin Day ${index + 1}`,
            }));
          updateDataStatus(
            "Bitcoin data loaded - showing Austrian value discovery"
          );
        }
      }

      async function loadHousingData() {
        // Simulated housing data showing regulatory constraints
        // (In real implementation, would use Zillow or similar API)
        realMarketData.housing = Array.from({ length: 15 }, (_, i) => ({
          x: i * 2, // Housing units
          y: 200 + Math.pow(i, 1.5) * 10 + (i > 8 ? 50 : 0), // Price jumps due to zoning
          label: `Housing Zone ${i + 1}`,
        }));
        updateDataStatus(
          "Housing data loaded - showing regulatory price distortions"
        );
      }

      async function loadTechData() {
        // Tech product data showing economies of scale
        realMarketData.tech = Array.from({ length: 12 }, (_, i) => ({
          x: Math.pow(i + 1, 1.5), // Production volume
          y: 500 / (1 + i * 0.3), // Price decreases with volume
          label: `Tech Volume ${i + 1}`,
        }));
        updateDataStatus("Tech data loaded - showing downward-sloping supply");
      }

      async function loadLuxuryData() {
        // Luxury goods showing Veblen effects
        realMarketData.luxury = Array.from({ length: 10 }, (_, i) => ({
          x: i * 3, // Quantity
          y: 100 + i * 20 + Math.pow(i, 1.3) * 5, // Price increases with "exclusivity"
          label: `Luxury Item ${i + 1}`,
        }));
        updateDataStatus("Luxury data loaded - showing upward-sloping demand");
      }

      function updateDataStatus(message) {
        const statusElement = document.getElementById("data-status-supply");
        if (statusElement) {
          statusElement.textContent = message;
        }
      }

      function getRealDataToShow() {
        const selection = document.getElementById("real-data-select").value;
        if (selection === "none") return [];
        return realMarketData[selection] || [];
      }

      // Supply and Demand Implementation
      const ctxSupplyDemand = document
        .getElementById("growthChartSupplyDemand")
        .getContext("2d");
      let chartSupplyDemand;

      function simulateSupplyDemand(a, b, c, d, marketType = "traditional") {
        const marketParams = getMarketParameters(marketType);

        // Find equilibrium using bisection method
        let qLow = 0.01;
        let qHigh = 100;
        let eqQ = 25;

        const calcDemandPrice = (q) => marketParams.demandFunction(q, a, b);
        const calcSupplyPrice = (q) => marketParams.supplyFunction(q, c, d);
        const excessDemand = (q) => calcDemandPrice(q) - calcSupplyPrice(q);

        const edLow = excessDemand(qLow);
        const edHigh = excessDemand(qHigh);

        // Try to find equilibrium
        let equilibriumFound = true;
        if (edLow * edHigh > 0) {
          // No single equilibrium - this is actually interesting for Austrian theory!
          equilibriumFound = false;
          eqQ = 25; // Use a reasonable middle point
        } else {
          // Bisection method to find equilibrium
          for (let i = 0; i < 50; i++) {
            eqQ = (qLow + qHigh) / 2;
            const ed = excessDemand(eqQ);

            if (Math.abs(ed) < 0.1) break;

            if (ed > 0) {
              qLow = eqQ;
            } else {
              qHigh = eqQ;
            }
          }
        }

        const eqP = calcDemandPrice(eqQ);

        // Generate curve data
        const maxQ = Math.ceil(Math.max(60, eqQ * 2));
        const numPoints = 25;
        const quantity = Array.from(
          { length: numPoints },
          (_, i) => (i * maxQ) / (numPoints - 1)
        );

        const demandPrice = quantity.map((q) =>
          Math.max(0, calcDemandPrice(q))
        );
        const supplyPrice = quantity.map((q) =>
          Math.max(0, calcSupplyPrice(q))
        );

        // Build datasets
        const datasets = [
          {
            label: `Demand (${marketParams.description})`,
            data: quantity.map((q, i) => ({ x: q, y: demandPrice[i] })),
            borderColor: "#6f42c1",
            backgroundColor: "rgba(111, 66, 193, 0.1)",
            borderWidth: 3,
            showLine: true,
            fill: false,
            tension: 0.1,
            pointRadius: 0,
          },
          {
            label: "Supply",
            data: quantity.map((q, i) => ({ x: q, y: supplyPrice[i] })),
            borderColor: "#fd7e14",
            backgroundColor: "rgba(253, 126, 20, 0.1)",
            borderWidth: 3,
            showLine: true,
            fill: false,
            tension: 0.1,
            pointRadius: 0,
          },
        ];

        // Add equilibrium point if found
        if (equilibriumFound) {
          datasets.push({
            label: "Equilibrium",
            data: [{ x: eqQ, y: eqP }],
            backgroundColor: "#dc3545",
            borderColor: "#dc3545",
            pointRadius: 8,
            pointHoverRadius: 10,
            showLine: false,
          });
        }

        // Add real data if selected
        const realData = getRealDataToShow();
        if (realData.length > 0) {
          datasets.push({
            label: "Real Market Data",
            data: realData,
            backgroundColor: "#28a745",
            borderColor: "#28a745",
            borderWidth: 2,
            showLine: true,
            fill: false,
            pointRadius: 5,
            pointHoverRadius: 7,
            tension: 0.1,
          });
        }

        if (chartSupplyDemand) chartSupplyDemand.destroy();
        chartSupplyDemand = new Chart(ctxSupplyDemand, {
          type: "scatter",
          data: {
            datasets: datasets,
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
              },
              tooltip: {
                callbacks: {
                  title: function (tooltipItems) {
                    const item = tooltipItems[0];
                    if (item.dataset.label === "Real Market Data") {
                      const point = item.raw;
                      return point.label || "Market Data Point";
                    }
                    if (item.dataset.label === "Equilibrium") {
                      return "Market Equilibrium";
                    }
                    return item.dataset.label + " Curve";
                  },
                  label: function (context) {
                    const point = context.raw;
                    if (context.dataset.label === "Real Market Data") {
                      return [
                        `Quantity: ${point.x.toFixed(1)} units`,
                        `Price: $${point.y.toFixed(2)}`,
                      ];
                    }
                    if (context.dataset.label === "Equilibrium") {
                      return [
                        `Quantity: ${point.x.toFixed(1)} units`,
                        `Price: $${point.y.toFixed(2)}`,
                      ];
                    }
                    return [
                      `Quantity: ${point.x.toFixed(1)} units`,
                      `Price: $${point.y.toFixed(2)}`,
                    ];
                  },
                },
              },
            },
            scales: {
              x: {
                title: { display: true, text: "Quantity (units)" },
                grid: { color: "rgba(0,0,0,0.1)" },
                min: 0,
              },
              y: {
                title: { display: true, text: "Price ($)" },
                grid: { color: "rgba(0,0,0,0.1)" },
                min: 0,
              },
            },
          },
        });

        // Display analysis
        const analysisText = equilibriumFound
          ? `<strong>Market Analysis (${marketType} model):</strong><br>
             <strong>Equilibrium Quantity:</strong> ${eqQ.toFixed(2)} units<br>
             <strong>Equilibrium Price:</strong> $${eqP.toFixed(2)}<br>
             <strong>Model Type:</strong> ${marketParams.description}<br>`
          : `<strong>Austrian Market Analysis:</strong><br>
             <strong>No Single Equilibrium:</strong> Multiple possible stable points<br>
             <strong>Price Discovery:</strong> Ongoing entrepreneurial process<br>
             <strong>Model Type:</strong> ${marketParams.description}<br>
             <em>This demonstrates Austrian insights about market complexity and uncertainty.</em>`;

        document.getElementById("equilibrium-supplydemand").innerHTML =
          analysisText;
      }

      function updateSupplyDemandSimulation() {
        const a = parseFloat(document.getElementById("a-supplydemand").value);
        const b = parseFloat(document.getElementById("b-supplydemand").value);
        const c = parseFloat(document.getElementById("c-supplydemand").value);
        const d = parseFloat(document.getElementById("d-supplydemand").value);
        const marketType = document.getElementById("market-type-select").value;

        if (
          !isNaN(a) &&
          !isNaN(b) &&
          !isNaN(c) &&
          !isNaN(d) &&
          a > 0 &&
          b > 0 &&
          c >= 0 &&
          d > 0
        ) {
          simulateSupplyDemand(a, b, c, d, marketType);
        }
      }

      // Event listeners
      document
        .getElementById("market-type-select")
        .addEventListener("change", updateSupplyDemandSimulation);

      document
        .getElementById("a-supplydemand")
        .addEventListener("input", updateSupplyDemandSimulation);
      document
        .getElementById("b-supplydemand")
        .addEventListener("input", updateSupplyDemandSimulation);
      document
        .getElementById("c-supplydemand")
        .addEventListener("input", updateSupplyDemandSimulation);
      document
        .getElementById("d-supplydemand")
        .addEventListener("input", updateSupplyDemandSimulation);

      document
        .getElementById("real-data-select")
        .addEventListener("change", function () {
          const selection = this.value;
          if (selection !== "none") {
            loadRealMarketData(selection);
          } else {
            updateSupplyDemandSimulation();
          }
        });

      // Initial simulation
      updateSupplyDemandSimulation();

      // Handle resize
      let resizeTimeout;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          if (chartSupplyDemand) chartSupplyDemand.resize();
        }, 100);
      });
    </script>

    <!-- Shared Navigation -->
    <script src="shared-navigation.js"></script>
    <script>
      insertNavigation();
    </script>
  </body>
</html>
