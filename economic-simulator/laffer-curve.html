<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Tax Paradox: Challenging the Laffer Curve | Interactive Economic Simulator
    </title>

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="Challenge the traditional quadratic Laffer Curve with real data. Interactive simulator comparing traditional theory vs Gaussian models. Discover why bell-shaped curves better explain tax consent."
    />
    <meta
      name="keywords"
      content="Laffer curve, tax rates, tax revenue, optimal taxation, fiscal policy, supply-side economics, challenge economic theory, Gaussian model, quadratic vs bell curve, tax consent, tax paradox, interactive simulator, data-driven economics"
    />
    <meta name="author" content="Julien Reszka" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#28a745" />

    <!-- Open Graph -->
    <meta
      property="og:title"
      content="Tax Paradox: Challenge Traditional Laffer Curve Theory with Data"
    />
    <meta
      property="og:description"
      content="Interactive simulator that challenges traditional quadratic Laffer Curve theory. Compare traditional parabolic models vs Gaussian bell curves. Discover why data supports different tax consent patterns."
    />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://julienreszka.github.io/economic-simulator/laffer-curve.html"
    />
    <meta
      property="og:image"
      content="https://julienreszka.github.io/economic-simulator/laffer-curve-preview.png"
    />
    <meta property="og:site_name" content="Economic Curves Simulator" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Tax Paradox: Challenge Economic Theory with Data"
    />
    <meta
      name="twitter:description"
      content="Interactive simulator exploring tax rates vs consent to taxation. Modern interface."
    />
    <meta name="twitter:creator" content="@julienreszka" />

    <!-- Canonical URL -->
    <link
      rel="canonical"
      href="https://julienreszka.github.io/economic-simulator/laffer-curve.html"
    />

    <!-- Shared Styles -->
    <link rel="stylesheet" href="shared-styles.css" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      .laffer-specific {
      }

      .laffer-specific h3 {
        color: #28a745 !important;
      }
    </style>
  </head>

  <body>
    <div id="container">
      <!-- Navigation Breadcrumb -->
      <nav class="nav-breadcrumb" aria-label="Breadcrumb">
        <a href="index.html">← Back to All Curves</a>
      </nav>

      <h1>The Laffer Curve: Tax Rates vs Consent to Taxation</h1>

      <p>
        <strong>Challenging Traditional Tax Theory:</strong> For decades,
        economists have claimed the Laffer Curve follows a simple quadratic
        (parabolic) shape. But when you examine real-world data, this theory
        falls apart. This interactive simulator lets you compare the traditional
        quadratic model against what the data actually shows - a Gaussian
        (bell-shaped) curve that better captures the Right to Economic
        Attractiveness and the reality of tax consent.
      </p>

      <!-- Interactive Simulation -->
      <section id="laffer-section">
        <h2>Interactive Laffer Curve Simulator</h2>

        <form id="paramsFormLaffer">
          <div class="param-group">
            <label for="curve-type-select-laffer">Curve Model Type:</label>
            <select
              id="curve-type-select-laffer"
              aria-describedby="curve-type-laffer-help"
            >
              <option value="quadratic">
                Traditional Quadratic (Theoretical)
              </option>
              <option value="gaussian" selected>
                Gaussian Bell Curve (Data-Fitted)
              </option>
            </select>
            <small id="curve-type-laffer-help" class="help-text">
              Traditional theory claims quadratic, but real data fits Gaussian
              better
            </small>
          </div>

          <div class="param-group" id="quadratic-params" style="display: none">
            <label for="intercept-laffer"
              >Intercept (β₀, base revenue %):</label
            >
            <input
              type="number"
              id="intercept-laffer"
              value="10"
              step="0.1"
              min="-5"
              max="5"
              aria-describedby="intercept-laffer-help"
            />
            <small id="intercept-laffer-help" class="sr-only"
              >Revenue at 0% tax rate (usually 0)</small
            >

            <label for="linear-coeff-laffer"
              >Linear coefficient (β₁, positive):</label
            >
            <input
              type="number"
              id="linear-coeff-laffer"
              value="1.2"
              step="0.1"
              min="0.1"
              max="3"
              aria-describedby="linear-coeff-laffer-help"
            />
            <small id="linear-coeff-laffer-help" class="sr-only"
              >Initial positive effect of taxation</small
            >

            <label for="quadratic-coeff-laffer"
              >Quadratic coefficient (β₂, negative):</label
            >
            <input
              type="number"
              id="quadratic-coeff-laffer"
              value="-0.024"
              step="0.001"
              min="-0.05"
              max="-0.001"
              aria-describedby="quadratic-coeff-laffer-help"
            />
            <small id="quadratic-coeff-laffer-help" class="sr-only"
              >Diminishing returns effect (must be negative)</small
            >
          </div>

          <div class="param-group" id="gaussian-params">
            <label for="peak-laffer">Peak Tax Rate (optimal %):</label>
            <input
              type="number"
              id="peak-laffer"
              value="32"
              step="1"
              min="15"
              max="50"
              aria-describedby="peak-laffer-help"
            />
            <small id="peak-laffer-help" class="sr-only"
              >Tax rate at maximum consent</small
            >

            <label for="height-laffer">Peak Consent Level (%):</label>
            <input
              type="number"
              id="height-laffer"
              value="25"
              step="1"
              min="10"
              max="40"
              aria-describedby="height-laffer-help"
            />
            <small id="height-laffer-help" class="sr-only"
              >Maximum consent to taxation</small
            >

            <label for="width-laffer">Curve Width (spread):</label>
            <input
              type="number"
              id="width-laffer"
              value="12"
              step="1"
              min="5"
              max="20"
              aria-describedby="width-laffer-help"
            />
            <small id="width-laffer-help" class="sr-only"
              >How wide the bell curve is</small
            >
          </div>
        </form>

        <div class="param-group">
          <label for="country-select-laffer">Show Real Country Data:</label>
          <select
            id="country-select-laffer"
            aria-describedby="country-select-laffer-help"
          >
            <option value="all">All Countries</option>
            <option value="developed">Developed Countries</option>
            <option value="developing">Developing Countries</option>
            <option value="none">Hide Country Data</option>
          </select>
          <small id="country-select-laffer-help" class="help-text"
            >Real-world data from
            <a
              href="https://data.oecd.org/tax/tax-revenue.htm"
              target="_blank"
              rel="noopener"
              >OECD API</a
            >
            (<a
              href="https://data.oecd.org/tax/tax-revenue.htm"
              target="_blank"
              rel="noopener"
              >Tax burden</a
            >
            &
            <a
              href="https://data.oecd.org/tax/tax-revenue.htm"
              target="_blank"
              rel="noopener"
              >Tax effectiveness</a
            >)</small
          >
        </div>

        <div class="param-group">
          <label for="time-period-select-laffer"
            >Time Period for Averaging:</label
          >
          <select
            id="time-period-select-laffer"
            aria-describedby="time-period-laffer-help"
          >
            <option value="recent">
              Recent (2018-2023) - Post-crisis stability
            </option>
            <option value="decade" selected>
              Decade (2014-2023) - Full business cycle
            </option>
            <option value="long">
              Long-term (2010-2023) - Including financial crisis
            </option>
            <option value="structural">
              Structural (2005-2023) - Long-term trends
            </option>
          </select>
          <small id="time-period-laffer-help" class="help-text"
            >Longer periods smooth volatility but may include outdated
            regimes</small
          >
          <div
            id="data-status-laffer"
            class="help-text"
            style="margin-top: 5px; font-weight: bold"
          >
            Loading...
          </div>
        </div>

        <div class="param-group">
          <label for="highlight-country-select-laffer"
            >Highlight Specific Country:</label
          >
          <select
            id="highlight-country-select-laffer"
            aria-describedby="highlight-country-laffer-help"
          >
            <option value="none">No country highlighted</option>
          </select>
          <small id="highlight-country-laffer-help" class="help-text"
            >Select a country to highlight with a red dot</small
          >
        </div>

        <div
          class="chart-container"
          role="img"
          aria-labelledby="laffer-chart-label"
        >
          <canvas
            id="growthChartLaffer"
            aria-label="Interactive Laffer Curve showing relationship between tax rates and consent to taxation"
          ></canvas>
          <div id="laffer-chart-label" class="sr-only">
            Chart displaying the Laffer Curve with tax rate on x-axis and
            consent to taxation on y-axis
          </div>
        </div>

        <div
          id="optimal-laffer"
          class="results-display"
          aria-live="polite"
        ></div>
      </section>

      <!-- Detailed Explanation -->
      <section>
        <h2>The Laffer Curve Theory vs. Reality</h2>

        <div style="margin-top: 15px; line-height: 1.6">
          <p>
            The Laffer Curve illustrates the relationship between tax rates and
            consent to taxation (often measured as tax revenue, but more
            fundamentally representing voluntary participation in the tax
            system). Named after economist Arthur Laffer, this curve suggests
            that beyond a certain point, higher tax rates actually decrease
            rather than increase effective tax collection and economic
            attractiveness.
          </p>

          <p>
            <strong>But here's the problem:</strong> The traditional theory
            assumes a simple quadratic (parabolic) relationship, while
            real-world data consistently shows a Gaussian (bell-shaped) pattern.
            This isn't just an academic detail - it fundamentally changes our
            understanding of optimal tax policy and economic attractiveness.
          </p>

          <h3>What the Traditional Theory Claimed</h3>
          <p>The traditional quadratic Laffer Curve assumed:</p>
          <p style="text-align: center; font-style: italic; margin: 20px 0">
            Tax Revenue = β₀ + β₁ × Tax Rate + β₂ × Tax Rate²
          </p>
          <p>
            Where β₀ is the intercept, β₁ is positive (initial revenue
            increase), and β₂ is negative (diminishing returns). This creates a
            simple parabola that peaks at -β₁/(2β₂) and suggests tax revenue
            starts at zero when tax rates are zero.
          </p>

          <h3>Why the Gaussian Model Actually Makes Sense</h3>
          <p>
            <strong
              >The real-world data consistently fits a Gaussian (bell curve)
              pattern better than the traditional quadratic model.</strong
            >
            While both models can show an optimal tax rate where revenue peaks,
            there are crucial differences that make the Gaussian model far
            superior for understanding real-world tax dynamics:
          </p>

          <h4>Mathematical Behavior at Extremes</h4>
          <ul>
            <li>
              <strong>Quadratic Problem:</strong> Can produce negative tax
              revenue at very high rates, which is mathematically absurd. Even
              with a 100% tax rate, governments still collect
              <em>some</em> revenue from people who can't evade completely.
            </li>
            <li>
              <strong>Gaussian Solution:</strong> Naturally approaches zero but
              never goes negative, reflecting the realistic lower bound of tax
              collection.
            </li>
          </ul>

          <h4>Symmetry and Real-World Behavior</h4>
          <ul>
            <li>
              <strong>Quadratic Flaw:</strong> Perfectly symmetrical around the
              peak - suggests that 10% and 50% tax rates (equidistant from a 30%
              optimum) produce identical consent levels, which contradicts all
              evidence about tax behavior.
            </li>
            <li>
              <strong>Gaussian Reality:</strong> Can be adjusted for asymmetry,
              reflecting that very low taxes (inadequate services) and very high
              taxes (confiscatory) fail for different reasons and at different
              rates.
            </li>
          </ul>

          <h4>Tail Behavior and Long-term Dynamics</h4>
          <ul>
            <li>
              <strong>Quadratic Absurdity:</strong> Eventually curves back up if
              extended far enough - suggesting that extremely high tax rates
              (like 200%+) would somehow increase consent again.
            </li>
            <li>
              <strong>Gaussian Logic:</strong> Exponentially decays toward zero,
              matching the reality that consent diminishes rapidly as tax rates
              become extreme.
            </li>
          </ul>

          <h4>Empirical Fit to Real Data</h4>
          <ul>
            <li>
              <strong>Quadratic Limitation:</strong> Forces a rigid mathematical
              relationship that often doesn't match the clustering patterns seen
              in actual country data.
            </li>
            <li>
              <strong>Gaussian Flexibility:</strong> Better captures the
              bell-shaped distribution of country performance around optimal tax
              rates observed in real-world data.
            </li>
          </ul>

          <h4>Behavioral Psychology</h4>
          <p>
            The Gaussian model reflects the reality that human responses to
            taxation follow normal distribution patterns. There's a natural
            "sweet spot" where people feel they're getting good value for their
            taxes, and satisfaction drops off in a bell curve pattern as you
            move away from that optimum. This isn't just about economic
            calculation - it's about psychological perceptions of fairness,
            effectiveness, and social contract legitimacy.
          </p>

          <h3>Mathematical Formulations: Theory vs. Data</h3>

          <h4>Traditional Quadratic Model (Theoretical)</h4>
          <p style="text-align: center; font-style: italic; margin: 20px 0">
            Tax Revenue = β₀ + β₁ × Tax Rate + β₂ × Tax Rate²
          </p>
          <p>
            This simple parabolic model assumes revenue starts near zero, rises
            linearly, then falls due to diminishing returns. However, it fails
            to capture the complex behavioral and institutional factors that
            drive tax consent.
          </p>

          <h4>Gaussian Model (Data-Fitted)</h4>
          <p style="text-align: center; font-style: italic; margin: 20px 0">
            Consent to Taxation = Height × e^(-((Tax Rate - Peak)²)/(2 ×
            Width²))
          </p>
          <p>
            Where Height represents the maximum consent level, Peak is the
            optimal tax rate, and Width controls how quickly consent falls off
            as tax rates deviate from the optimum. This natural bell curve shape
            better reflects the economic reality that consent to taxation peaks
            at moderate rates and declines symmetrically for both very low and
            very high rates, capturing the institutional and behavioral
            complexities that the quadratic model misses.
          </p>

          <h3>Curve Structure</h3>
          <p>The curve demonstrates the counterintuitive relationship where:</p>
          <ul>
            <li>
              <strong>Rising Phase (0-32% typically):</strong> Moderate tax
              rates increase both revenue and perceived value of public services
            </li>
            <li>
              <strong>Peak (32% typically):</strong> Optimal tax rate that
              maximizes both revenue and voluntary compliance
            </li>
            <li>
              <strong>Declining Phase (32%+):</strong> High tax rates reduce
              work incentives, encourage avoidance/evasion, and drive capital
              flight
            </li>
          </ul>

          <h3>Why Consent to Taxation Increases Initially</h3>
          <p>
            The upward slope of the early curve reflects several factors that
            make moderate taxation attractive to citizens:
          </p>
          <ul>
            <li>
              <strong>Public Goods Provision:</strong> Essential services like
              security, courts, and infrastructure that enable prosperity
            </li>
            <li>
              <strong>Social Insurance:</strong> Risk pooling and safety nets
              that provide security and stability
            </li>
            <li>
              <strong>Network Effects:</strong> More taxpayers mean better
              public services and stronger institutions per dollar contributed
            </li>
            <li>
              <strong>Rule of Law:</strong> Tax-funded legal systems that
              protect property rights and enforce contracts
            </li>
            <li>
              <strong>Market Infrastructure:</strong> Standards, regulations,
              and frameworks that reduce transaction costs
            </li>
            <li>
              <strong>Legitimacy Premium:</strong> Citizens value being part of
              a well-functioning, prosperous society
            </li>
            <li>
              <strong>Economic Attraction:</strong> Lower taxes than competitors
              while maintaining quality institutions attracts productive
              residents and businesses
            </li>
          </ul>
          <p>
            This creates a virtuous cycle where moderate, well-used taxation
            enhances the economic attractiveness of a jurisdiction, encouraging
            voluntary participation and compliance.
          </p>

          <h3>How Consent to Taxation is Computed</h3>
          <p>
            Now that we understand why the Gaussian model is superior, let's
            examine how we translate real-world country data into meaningful
            "consent to taxation" measurements. For real country data points,
            consent to taxation is calculated using a two-step process that
            combines theoretical expectations with actual tax collection
            efficiency:
          </p>
          <ol>
            <li>
              <strong>Base Laffer Curve:</strong> First, we calculate where each
              country should theoretically fall on the curve based on their tax
              burden compared to the optimal rate (32%). Countries closer to the
              optimal rate get higher base consent scores using the same
              Gaussian formula.
            </li>
            <li>
              <strong>Efficiency Adjustment:</strong> Then we adjust this score
              based on how efficiently the country actually collects taxes. We
              calculate an efficiency ratio (tax revenue ÷ tax burden) and use
              this to boost or penalize the consent score. Countries that
              collect taxes more effectively get higher final consent scores,
              reflecting that citizens are more willing to pay taxes when they
              see effective governance.
            </li>
          </ol>
          <p>
            This approach recognizes that consent to taxation depends not just
            on the tax rate itself, but also on citizens' perception of whether
            their taxes are being collected and used effectively by competent
            institutions.
          </p>

          <h3>Policy Implications</h3>
          <ul>
            <li>
              <strong>Revenue Maximization:</strong> There exists an optimal tax
              rate beyond which additional increases reduce total revenue
            </li>
            <li>
              <strong>Economic Behavior:</strong> High tax rates change
              incentives for work, saving, investment, and legal compliance
            </li>
            <li>
              <strong>Jurisdictional Competition:</strong> Tax rates affect
              attractiveness relative to other regions or countries
            </li>
            <li>
              <strong>Dynamic Effects:</strong> Tax changes influence long-term
              economic growth and tax base expansion
            </li>
            <li>
              <strong>Voluntary Compliance:</strong> Legitimacy and consent are
              as important as legal enforcement for effective taxation
            </li>
          </ul>

          <h3>Historical Context</h3>
          <p>
            The concept gained prominence in the 1970s when Arthur Laffer
            demonstrated to policymakers that the U.S. might be on the
            downward-sloping portion of the curve. The theory influenced the tax
            reforms of the 1980s in multiple countries. Historical examples
            include the Kennedy tax cuts of the 1960s, Reagan's reforms in the
            1980s, and various flat tax implementations in Eastern Europe.
          </p>

          <h3>Understanding Negative Revenue Values</h3>
          <p>
            When the curve shows negative values, this represents scenarios
            where taxation becomes counterproductive to economic attractiveness:
          </p>
          <ul>
            <li>
              <strong>Capital Flight:</strong> High tax rates drive productive
              individuals and businesses to relocate
            </li>
            <li>
              <strong>Underground Economy:</strong> Excessive taxation pushes
              economic activity into informal, untaxed sectors
            </li>
            <li>
              <strong>Work Disincentives:</strong> High marginal rates reduce
              incentives for productive activity
            </li>
            <li>
              <strong>Compliance Costs:</strong> Complex tax systems consume
              resources that could be used productively
            </li>
            <li>
              <strong>Economic Distortions:</strong> Tax-driven behavior changes
              that reduce overall economic efficiency
            </li>
            <li>
              <strong>Brain Drain:</strong> Loss of highly skilled individuals
              to lower-tax jurisdictions
            </li>
          </ul>
          <p>
            Examples include France's experience with its 75% tax on high
            earners (many wealthy citizens relocated), and Greece during its
            fiscal crisis where high tax rates coincided with massive tax
            evasion and economic contraction.
          </p>

          <h3>Comparative Findings</h3>
          <ul>
            <li>
              <strong>Developed Countries:</strong> Optimal total tax rates
              (including all taxes) typically range from 30-45% of income
            </li>
            <li>
              <strong>Small Open Economies:</strong> Must maintain competitive
              tax rates due to capital mobility
            </li>
            <li>
              <strong>Emerging Markets:</strong> Often benefit from lower rates
              to attract investment and build tax compliance culture
            </li>
          </ul>

          <p>
            The Laffer Curve demonstrates that economic attractiveness requires
            finding the optimal balance between providing valuable public
            services and maintaining competitive tax rates that encourage
            voluntary participation in the tax system.
          </p>
        </div>
      </section>

      <!-- Natural Right Section -->
      <section class="natural-rights-section">
        <h2>The Right to Economic Attractiveness</h2>

        <div class="right-card laffer-specific">
          <div class="right-principle">
            <p>
              <strong>Negative Right:</strong> Freedom from confiscatory
              taxation that destroys economic attractiveness and drives
              productive individuals and capital away from a jurisdiction.
            </p>
          </div>

          <h4>Positive Institutional Foundations Required</h4>
          <div class="right-positive">
            <h4>Essential Institutions for Tax Attractiveness:</h4>
            <ul>
              <li>
                <strong>Constitutional Tax Limitations:</strong> Legal caps on
                maximum tax rates to prevent confiscatory taxation
              </li>
              <li>
                <strong>Tax Competition Frameworks:</strong> Legal structures
                enabling jurisdictional competition to discipline excessive
                taxation
              </li>
              <li>
                <strong>Transparent Budget Processes:</strong> Clear accounting
                of tax revenue use to maintain consent and legitimacy
              </li>
              <li>
                <strong>Simplicity Requirements:</strong> Legal mandates for
                clear, understandable tax codes to reduce compliance costs
              </li>
              <li>
                <strong>Sunset Provisions:</strong> Automatic expiration of
                temporary taxes and spending programs
              </li>
              <li>
                <strong>Tax Impact Assessment:</strong> Mandatory analysis of
                economic effects before implementing tax changes
              </li>
              <li>
                <strong>Taxpayer Rights Protection:</strong> Due process
                safeguards and appeals mechanisms for tax disputes
              </li>
            </ul>
          </div>

          <h4>Current Threats to This Right</h4>
          <div class="right-enemies">
            <h4>Institutional Enemies of Tax Attractiveness:</h4>
            <ul>
              <li>
                <strong>Progressive Rate Escalation:</strong> Incrementally
                higher rates that eventually reach confiscatory levels
              </li>
              <li>
                <strong>Hidden Tax Multiplication:</strong> Multiple overlapping
                tax jurisdictions creating effective rates higher than apparent
              </li>
              <li>
                <strong>Regulatory Taxation:</strong> Using regulations and fees
                to extract revenue beyond formal tax limits
              </li>
              <li>
                <strong>Retroactive Tax Changes:</strong> Changing rules after
                economic decisions have been made
              </li>
              <li>
                <strong>Tax Code Complexity:</strong> Deliberately complex
                systems that favor insiders and increase compliance costs
              </li>
              <li>
                <strong>Exit Restrictions:</strong> Barriers to leaving high-tax
                jurisdictions including exit taxes and residency rules
              </li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <script>
      // Real-world data integration
      let countryDataLaffer = {
        developed: [],
        developing: [],
      };

      let isDataLoadedLaffer = false;

      // Country classifications for Laffer curve (focus on OECD countries)
      const developedCountriesLaffer = [
        "USA",
        "DEU",
        "FRA",
        "GBR",
        "JPN",
        "CAN",
        "AUS",
        "CHE",
        "NLD",
        "SWE",
        "NOR",
        "DNK",
        "KOR",
        "SGP",
        "FIN",
        "AUT",
        "BEL",
        "IRL",
        "POL",
        "ISR",
        "ITA",
        "ESP",
        "PRT",
        "GRC",
        "CZE",
        "SVK",
        "SVN",
        "EST",
        "LVA",
        "LTU",
        "HUN",
        "LUX",
        "ISL",
        "NZL",
        "HKG",
        "TWN",
        "MAC",
      ];

      const developingCountriesLaffer = [
        "CHN",
        "IND",
        "VNM",
        "BGD",
        "ETH",
        "RWA",
        "IDN",
        "PHL",
        "BRA",
        "MEX",
        "TUR",
        "CHL",
        "ZAF",
        "ARG",
        "VEN",
        "THA",
        "MYS",
        "EGY",
        "PRK",
        "CUB",
        "RUS",
        "IRN",
        "COL",
        "CRI",
        "PER",
        "ECU",
        "URY",
        "BOL",
        "PRY",
        "NGA",
        "KEN",
        "GHA",
        "TZA",
        "UGA",
        "ZMB",
        "BWA",
        "NAM",
        "MAR",
        "TUN",
        "DZA",
        "JOR",
        "LBN",
        "OMN",
        "QAT",
        "KWT",
        "SAU",
        "ARE",
        "BHR",
        "KAZ",
        "UZB",
        "UKR",
        "BLR",
        "MDA",
        "GEO",
        "ARM",
        "AZE",
        "SRB",
        "HRV",
        "BGR",
        "ROU",
        "MKD",
        "ALB",
        "BIH",
        "MNE",
        "PAK",
        "LKA",
        "NPL",
        "AFG",
        "MMR",
        "KHM",
        "LAO",
        "MNG",
      ];

      // Fetch data from OECD and World Bank APIs
      async function fetchLafferData() {
        try {
          const allCountries = [
            ...developedCountriesLaffer,
            ...developingCountriesLaffer,
          ];

          // Fetch OECD tax burden data
          const oecdResponse = await fetch(
            `https://sdmx.oecd.org/public/rest/data/OECD.CTP.TPS,DSD_REV_COMP_OECD@DF_RSOECD,1.0/..S13._T..PT_B1GQ.A?startPeriod=2005&endPeriod=2023&format=jsondata`
          );
          const oecdData = await oecdResponse.json();

          // Fetch World Bank GDP per capita data
          const countryString = allCountries.join(";");
          const gdpResponse = await fetch(
            `https://api.worldbank.org/v2/country/${countryString}/indicator/NY.GDP.PCAP.CD?date=2005:2023&format=json&per_page=1000`
          );
          const gdpData = await gdpResponse.json();

          // Fetch World Bank tax revenue data (% of GDP)
          const taxRevenueResponse = await fetch(
            `https://api.worldbank.org/v2/country/${countryString}/indicator/GC.REV.XGRT.GD.ZS?date=2005:2023&format=json&per_page=1000`
          );
          const taxRevenueData = await taxRevenueResponse.json();

          // Store raw data globally
          window.rawOECDData = oecdData;
          window.rawGDPData = gdpData[1];
          window.rawTaxRevenueData = taxRevenueData[1];

          // Process with default time period
          processLafferDataForCurrentPeriod();
        } catch (error) {
          console.error("Error fetching Laffer curve data:", error);
          // Use fallback data
          countryDataLaffer = getLafferFallbackData();
          isDataLoadedLaffer = true;
          updateLafferDataStatus("Using embedded fallback data");
          updateLafferHighlightCountryOptions();
          updateLafferSimulation();
        }
      }

      function processLafferDataForCurrentPeriod() {
        const timePeriod = document.getElementById(
          "time-period-select-laffer"
        ).value;
        const dateRange = getLafferDateRangeForPeriod(timePeriod);

        // Process the data with selected time period
        const processedData = processLafferData(
          window.rawOECDData,
          window.rawGDPData,
          window.rawTaxRevenueData,
          dateRange
        );

        countryDataLaffer = processedData;
        isDataLoadedLaffer = true;

        updateLafferDataStatus(`Data loaded: ${dateRange.label}`);
        updateLafferHighlightCountryOptions();
        updateLafferSimulation();
      }

      function getLafferDateRangeForPeriod(period) {
        switch (period) {
          case "recent":
            return { start: 2018, end: 2023, label: "2018-2023 (Recent)" };
          case "decade":
            return { start: 2014, end: 2023, label: "2014-2023 (Decade)" };
          case "long":
            return { start: 2010, end: 2023, label: "2010-2023 (Long-term)" };
          case "structural":
            return { start: 2005, end: 2023, label: "2005-2023 (Structural)" };
          default:
            return { start: 2014, end: 2023, label: "2014-2023 (Default)" };
        }
      }

      function processLafferData(oecdRaw, gdpRaw, taxRevenueRaw, dateRange) {
        const countryAverages = {};

        // Process OECD tax burden data
        if (
          oecdRaw &&
          oecdRaw.data &&
          oecdRaw.data.dataSets &&
          oecdRaw.data.dataSets[0]
        ) {
          const dataset = oecdRaw.data.dataSets[0];
          const structure = oecdRaw.data.structures[0];

          // Extract country names and data
          const countries = structure.dimensions.series[0].values;
          const timePeriods = structure.dimensions.observation[0].values;

          Object.entries(dataset.series).forEach(([seriesKey, seriesData]) => {
            const countryIndex = parseInt(seriesKey.split(":")[0]);
            const country = countries[countryIndex];

            if (country && seriesData.observations) {
              Object.entries(seriesData.observations).forEach(
                ([timeIndex, observation]) => {
                  const year = parseInt(timePeriods[timeIndex].id);
                  if (
                    year >= dateRange.start &&
                    year <= dateRange.end &&
                    observation[0]
                  ) {
                    const countryCode = country.id;
                    const countryName = country.name;

                    if (!countryAverages[countryCode]) {
                      countryAverages[countryCode] = {
                        name: countryName,
                        taxBurden: [],
                        gdpPerCapita: [],
                        taxRevenue: [],
                      };
                    }
                    countryAverages[countryCode].taxBurden.push(observation[0]);
                  }
                }
              );
            }
          });
        }

        // Process World Bank GDP per capita data
        if (gdpRaw) {
          gdpRaw.forEach((item) => {
            if (
              item.value !== null &&
              item.date >= dateRange.start &&
              item.date <= dateRange.end
            ) {
              const countryCode = item.countryiso3code;
              if (countryAverages[countryCode]) {
                countryAverages[countryCode].gdpPerCapita.push(item.value);
              }
            }
          });
        }

        // Process World Bank tax revenue data
        if (taxRevenueRaw) {
          taxRevenueRaw.forEach((item) => {
            if (
              item.value !== null &&
              item.date >= dateRange.start &&
              item.date <= dateRange.end
            ) {
              const countryCode = item.countryiso3code;
              if (countryAverages[countryCode]) {
                countryAverages[countryCode].taxRevenue.push(item.value);
              }
            }
          });
        }

        // Calculate final averages and categorize
        const developed = [];
        const developing = [];

        Object.entries(countryAverages).forEach(([code, data]) => {
          if (
            data.taxBurden.length >= 3 &&
            data.gdpPerCapita.length >= 3 &&
            data.taxRevenue.length >= 3
          ) {
            const avgTaxBurden =
              data.taxBurden.reduce((a, b) => a + b) / data.taxBurden.length;
            const avgGDPPerCapita =
              data.gdpPerCapita.reduce((a, b) => a + b) /
              data.gdpPerCapita.length;
            const avgTaxRevenue =
              data.taxRevenue.reduce((a, b) => a + b) / data.taxRevenue.length;

            // Transform tax collection efficiency into a Laffer curve-style "consent to taxation"
            // Based on economic theory: optimal tax rate around 30-35% maximizes consent
            const optimalTaxRate = 32; // Economic literature suggests around 30-35%
            const maxConsentLevel = 25; // Peak consent level

            // Calculate distance from optimal rate
            const distanceFromOptimal = Math.abs(avgTaxBurden - optimalTaxRate);

            // Base Laffer curve calculation: consent decreases as we move away from optimal
            const baseConsent =
              maxConsentLevel *
              Math.exp(-Math.pow(distanceFromOptimal / 15, 2));

            // Adjust based on actual tax collection efficiency (preserve relative country performance)
            const efficiencyFactor = avgTaxRevenue / avgTaxBurden; // Original efficiency ratio
            const adjustmentFactor = (efficiencyFactor - 0.8) * 10; // Scale efficiency differences

            // Final consent level: base curve + efficiency adjustment
            const consentToTaxation = Math.max(
              0,
              baseConsent + adjustmentFactor
            );

            const countryInfo = {
              name: data.name,
              taxBurden: Math.round(avgTaxBurden * 10) / 10,
              fdi: Math.round(consentToTaxation * 10) / 10,
              year: dateRange.label,
              dataPoints: Math.min(
                data.taxBurden.length,
                data.gdpPerCapita.length,
                data.taxRevenue.length
              ),
            };

            if (developedCountriesLaffer.includes(code)) {
              developed.push(countryInfo);
            } else if (developingCountriesLaffer.includes(code)) {
              developing.push(countryInfo);
            }
          }
        });

        return { developed, developing };
      }

      function getLafferFallbackData() {
        return {
          developed: [
            {
              name: "Ireland",
              taxBurden: 22.3,
              fdi: 105.0,
              year: "2018-2023 (Recent)",
              dataPoints: 5,
            },
            {
              name: "Switzerland",
              taxBurden: 27.8,
              fdi: 118.0,
              year: "2018-2023 (Recent)",
              dataPoints: 5,
            },
            {
              name: "United States",
              taxBurden: 25.5,
              fdi: 102.0,
              year: "2018-2023 (Recent)",
              dataPoints: 6,
            },
            {
              name: "United Kingdom",
              taxBurden: 32.5,
              fdi: 108.0,
              year: "2018-2023 (Recent)",
              dataPoints: 5,
            },
            {
              name: "Germany",
              taxBurden: 38.2,
              fdi: 112.0,
              year: "2018-2023 (Recent)",
              dataPoints: 6,
            },
            {
              name: "France",
              taxBurden: 45.1,
              fdi: 98.0,
              year: "2018-2023 (Recent)",
              dataPoints: 6,
            },
          ],
          developing: [
            {
              name: "China",
              taxBurden: 18.5,
              fdi: 88.0,
              year: "2018-2023 (Recent)",
              dataPoints: 5,
            },
            {
              name: "Brazil",
              taxBurden: 32.3,
              fdi: 85.0,
              year: "2018-2023 (Recent)",
              dataPoints: 5,
            },
            {
              name: "Mexico",
              taxBurden: 16.2,
              fdi: 72.0,
              year: "2018-2023 (Recent)",
              dataPoints: 6,
            },
            {
              name: "Turkey",
              taxBurden: 24.5,
              fdi: 78.0,
              year: "2018-2023 (Recent)",
              dataPoints: 5,
            },
          ],
        };
      }

      function updateLafferDataStatus(message) {
        const statusElement = document.getElementById("data-status-laffer");
        if (statusElement) {
          statusElement.textContent = message;
          statusElement.style.color = isDataLoadedLaffer
            ? "#28a745"
            : "#dc3545";
        }
      }

      function updateLafferHighlightCountryOptions() {
        const select = document.getElementById(
          "highlight-country-select-laffer"
        );
        if (!select) return;

        select.innerHTML =
          '<option value="none">No country highlighted</option>';

        if (!isDataLoadedLaffer) return;

        const allCountries = [
          ...countryDataLaffer.developed,
          ...countryDataLaffer.developing,
        ];
        allCountries.sort((a, b) => a.name.localeCompare(b.name));

        allCountries.forEach((country) => {
          const option = document.createElement("option");
          option.value = country.name;
          option.textContent = country.name;
          select.appendChild(option);
        });
      }

      function getLafferCountryDataToShow() {
        if (!isDataLoadedLaffer) return [];

        const selection = document.getElementById(
          "country-select-laffer"
        ).value;
        if (selection === "none") return [];
        if (selection === "all")
          return [
            ...countryDataLaffer.developed,
            ...countryDataLaffer.developing,
          ];
        return countryDataLaffer[selection] || [];
      }

      // Laffer Curve Implementation
      const ctxLaffer = document
        .getElementById("growthChartLaffer")
        .getContext("2d");
      let chartLaffer;

      function simulateCurveLaffer(params) {
        const taxRate = Array.from({ length: 61 }, (_, i) => i); // 0% to 60%

        const curveType =
          document.getElementById("curve-type-select-laffer")?.value ||
          "gaussian";
        let consent;

        if (curveType === "quadratic") {
          // Traditional quadratic model
          const beta0 = params.intercept || 10;
          const beta1 = params.linearCoeff || 1.2;
          const beta2 = params.quadraticCoeff || -0.024;
          consent = taxRate.map((t) => beta0 + beta1 * t + beta2 * t * t);
        } else {
          // Gaussian curve (data-fitted)
          const peak = params.peak || 32;
          const height = params.height || 25;
          const width = params.width || 12;
          consent = taxRate.map(
            (t) =>
              height *
              Math.exp(-Math.pow(t - peak, 2) / (2 * Math.pow(width, 2)))
          );
        }

        const countriesToShow = getLafferCountryDataToShow();
        const highlightCountry = document.getElementById(
          "highlight-country-select-laffer"
        )?.value;

        const datasets = [
          {
            label: "Theoretical Laffer Curve",
            data: taxRate.map((x, i) => ({ x: x, y: consent[i] })),
            borderColor: "#28a745",
            backgroundColor: "rgba(40, 167, 69, 0.1)",
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            type: "line",
            pointRadius: 0,
          },
        ];

        if (countriesToShow.length > 0) {
          const highlightedCountryData =
            highlightCountry !== "none"
              ? countriesToShow.find((c) => c.name === highlightCountry)
              : null;

          const regularCountries = countriesToShow.filter(
            (c) => c.name !== highlightCountry
          );

          // Add developed countries
          const developedCountries = regularCountries.filter((c) =>
            countryDataLaffer.developed.includes(c)
          );
          if (developedCountries.length > 0) {
            datasets.push({
              label: "Developed Countries",
              data: developedCountries.map((c) => ({
                x: c.taxBurden,
                y: c.fdi,
                countryName: c.name,
                year: c.year,
                dataPoints: c.dataPoints,
              })),
              backgroundColor: "rgba(40, 167, 69, 0.8)",
              borderColor: "#28a745",
              borderWidth: 2,
              pointRadius: 6,
              pointHoverRadius: 8,
              type: "scatter",
              showLine: false,
            });
          }

          // Add developing countries
          const developingCountries = regularCountries.filter((c) =>
            countryDataLaffer.developing.includes(c)
          );
          if (developingCountries.length > 0) {
            datasets.push({
              label: "Developing Countries",
              data: developingCountries.map((c) => ({
                x: c.taxBurden,
                y: c.fdi,
                countryName: c.name,
                year: c.year,
                dataPoints: c.dataPoints,
              })),
              backgroundColor: "rgba(255, 193, 7, 0.8)",
              borderColor: "#ffc107",
              borderWidth: 2,
              pointRadius: 6,
              pointHoverRadius: 8,
              type: "scatter",
              showLine: false,
            });
          }

          // Add highlighted country
          if (highlightedCountryData) {
            datasets.push({
              label: `Highlighted: ${highlightedCountryData.name}`,
              data: [
                {
                  x: highlightedCountryData.taxBurden,
                  y: highlightedCountryData.fdi,
                  countryName: highlightedCountryData.name,
                  year: highlightedCountryData.year,
                  dataPoints: highlightedCountryData.dataPoints,
                },
              ],
              backgroundColor: "rgba(220, 53, 69, 0.9)",
              borderColor: "#dc3545",
              borderWidth: 3,
              pointRadius: 8,
              pointHoverRadius: 10,
              type: "scatter",
              showLine: false,
            });
          }
        }

        if (chartLaffer) chartLaffer.destroy();
        chartLaffer = new Chart(ctxLaffer, {
          type: "line",
          data: {
            datasets: datasets,
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
              },
              tooltip: {
                callbacks: {
                  title: function (tooltipItems) {
                    const item = tooltipItems[0];
                    if (item.dataset.type === "scatter") {
                      const dataPoint = item.dataset.data[item.dataIndex];
                      return dataPoint.countryName || "Country";
                    }
                    return (
                      "Tax Burden: " + item.parsed.x.toFixed(1) + "% of GDP"
                    );
                  },
                  label: function (context) {
                    if (context.dataset.type === "scatter") {
                      const dataPoint = context.dataset.data[context.dataIndex];
                      return [
                        "Tax Burden: " +
                          context.parsed.x.toFixed(1) +
                          "% of GDP",
                        "Consent to Taxation: " +
                          context.parsed.y.toFixed(1) +
                          "%",
                        "Period: " + (dataPoint.year || "2014-2023"),
                        "Data points: " +
                          (dataPoint.dataPoints || "N/A") +
                          " years",
                      ];
                    }
                    return (
                      "Consent to Taxation: " +
                      context.parsed.y.toFixed(1) +
                      "%"
                    );
                  },
                },
              },
            },
            scales: {
              x: {
                type: "linear",
                position: "bottom",
                title: {
                  display: true,
                  text: "Tax Burden (% of GDP)",
                },
                grid: { color: "rgba(0,0,0,0.1)" },
                min: 0,
                max: 60,
              },
              y: {
                type: "linear",
                title: { display: true, text: "Consent to Taxation (%)" },
                grid: { color: "rgba(0,0,0,0.1)" },
              },
            },
          },
        });

        // Calculate optimal based on curve type
        let optimal, maxConsent, curveTypeLabel, explanation;

        if (curveType === "quadratic") {
          const beta1 = params.linearCoeff || 1.2;
          const beta2 = params.quadraticCoeff || -0.024;
          optimal = -beta1 / (2 * beta2);
          const beta0 = params.intercept || 10;
          maxConsent = beta0 + beta1 * optimal + beta2 * optimal * optimal;
          curveTypeLabel = "Traditional Quadratic";
          explanation =
            "Traditional theory suggests this parabolic optimum, but real data challenges this model.";
        } else {
          optimal = params.peak || 32;
          maxConsent = params.height || 25;
          curveTypeLabel = "Gaussian (Data-Fitted)";
          explanation =
            "This bell curve better fits real-world data and captures the true dynamics of tax consent.";
        }

        document.getElementById("optimal-laffer").innerHTML = `
                <strong>Optimal Tax Rate:</strong> ${optimal.toFixed(2)}%<br>
                <strong>Maximum Consent Level:</strong> ${maxConsent.toFixed(
                  2
                )}%<br>
                <strong>Curve Type:</strong> ${curveTypeLabel}<br>
                <em>${explanation}</em>
            `;
      }

      function updateLafferSimulation() {
        const curveType =
          document.getElementById("curve-type-select-laffer")?.value ||
          "gaussian";

        let params = {};

        if (curveType === "quadratic") {
          params = {
            intercept: parseFloat(
              document.getElementById("intercept-laffer")?.value || 10
            ),
            linearCoeff: parseFloat(
              document.getElementById("linear-coeff-laffer")?.value || 1.2
            ),
            quadraticCoeff: parseFloat(
              document.getElementById("quadratic-coeff-laffer")?.value || -0.024
            ),
          };
        } else {
          params = {
            peak: parseFloat(
              document.getElementById("peak-laffer")?.value || 32
            ),
            height: parseFloat(
              document.getElementById("height-laffer")?.value || 25
            ),
            width: parseFloat(
              document.getElementById("width-laffer")?.value || 12
            ),
          };
        }

        simulateCurveLaffer(params);
      }

      function toggleLafferParameterGroups() {
        const curveType = document.getElementById(
          "curve-type-select-laffer"
        ).value;
        const quadraticGroup = document.getElementById("quadratic-params");
        const gaussianGroup = document.getElementById("gaussian-params");

        if (curveType === "quadratic") {
          quadraticGroup.style.display = "block";
          gaussianGroup.style.display = "none";
        } else {
          quadraticGroup.style.display = "none";
          gaussianGroup.style.display = "block";
        }

        updateLafferSimulation();
      }

      // Event listeners
      document
        .getElementById("curve-type-select-laffer")
        .addEventListener("change", toggleLafferParameterGroups);
      document
        .getElementById("peak-laffer")
        .addEventListener("input", updateLafferSimulation);
      document
        .getElementById("height-laffer")
        .addEventListener("input", updateLafferSimulation);
      document
        .getElementById("width-laffer")
        .addEventListener("input", updateLafferSimulation);
      document
        .getElementById("intercept-laffer")
        ?.addEventListener("input", updateLafferSimulation);
      document
        .getElementById("linear-coeff-laffer")
        ?.addEventListener("input", updateLafferSimulation);
      document
        .getElementById("quadratic-coeff-laffer")
        ?.addEventListener("input", updateLafferSimulation);
      document
        .getElementById("country-select-laffer")
        .addEventListener("change", updateLafferSimulation);
      document
        .getElementById("highlight-country-select-laffer")
        .addEventListener("change", updateLafferSimulation);
      document
        .getElementById("time-period-select-laffer")
        .addEventListener("change", function () {
          if (window.rawOECDData && window.rawGDPData) {
            processLafferDataForCurrentPeriod();
          } else {
            updateLafferSimulation();
          }
        });

      // Initial simulation and data loading
      toggleLafferParameterGroups();

      // Load real data
      updateLafferDataStatus("Loading data from OECD and World Bank APIs...");
      fetchLafferData();

      // Handle resize
      let resizeTimeout;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          if (chartLaffer) chartLaffer.resize();
        }, 100);
      });
    </script>

    <!-- Shared Navigation -->
    <script src="shared-navigation.js"></script>
    <script>
      insertNavigation();
    </script>
  </body>
</html>
